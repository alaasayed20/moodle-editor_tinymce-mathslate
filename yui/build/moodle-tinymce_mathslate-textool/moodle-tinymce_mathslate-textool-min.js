YUI.add("moodle-tinymce_mathslate-textool",function(e,t){M.tinymce_mathslate=M.tinymce_mathslate||{};var n=M&&M.tinymce_mathslate||{};n.TeXTool=function(t,n){var r=e.Node.create('<input type="text">');r=e.one("#latex-input");var i=e.Node.create("<span>\\[ \\]</span>");n&&i.on("click",function(){n(i.json)}),e.one(t).appendChild(i),r.focus();var s=new e.DD.Drag({node:i});s.on("drag:end",function(){this.get("node").setStyle("top","0"),this.get("node").setStyle("left","0")}),i.toMathML=function(e){var t,n=window.MathJax.Hub.getAllJax(this.generateID())[0];try{t=n.root.toMathML("")}catch(r){if(!r.restart)throw r;return window.MathJax.Callback.After(["toMathML",this,n,e],r.restart)}window.MathJax.Callback(e)(t)},r.on("change",function(){var t=window.MathJax.Hub.getAllJax(i.generateID())[0],o=this.getDOMNode().value;if(!t)return;var u="";window.MathJax.Hub.Queue(["Text",t,this.getDOMNode().value]);var a=function(e){if(/<mtext mathcolor="red">/.test(e)||/<merror/.test(e))return;e=e.replace(/$\s+/mg," ");var t=e.replace(/^\s*<([a-z]*).*/,"$1");e=e.replace(/^\s*<[a-z]*/,""),u+='["'+t+'", {';while(e.trim().search(">")>1)u+=e.replace(/^ *([a-z]*) *= *"([^"]*)".*/,'"$1": "$2"'),e=e.replace(/^ *([a-z]*) *= *"([^"]*)"/,""),e.trim().search(">")>1&&(u+=", ");if(e.trim().match("^/>"))return u+="}]",e.trim().replace("/>","");u+="}, ",e=e.replace(/^ *>/,"");if(e.replace(new RegExp("^ *([^<]*).*"),"$1"))u+='"'+e.replace(/<.*/,"")+'"',e=e.replace(/^ *[^<]*/,""),e.trim().search("<!--")===0&&(e=e.replace(/<!--[^>]*-->/,""));else{u+="[";while(e.trim().search("</"+t+">")!==0)e=a(e),e.trim().search("</"+t+">")!==0&&(u+=", ");u+="]"}return u+="]",e.replace("</"+t+">","")};window.MathJax.Hub.Queue(["toMathML",i,a]),window.MathJax.Hub.Queue(function(){if(u==="")return;i.json=e.JSON.stringify(["mrow",{tex:[o]},e.JSON.parse(u)[2]]),s.set("data",i.json),n(i.json),r.select()})})}},"@VERSION@",{requires:["dd-drag","dd-proxy","dd-drop","event","json"]});
