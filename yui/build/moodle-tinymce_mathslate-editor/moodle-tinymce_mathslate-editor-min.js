YUI.add("moodle-tinymce_mathslate-editor",function(e,t){M&&(M.tinymce_mathslate=M.tinymce_mathslate||{});var n=M&&M.tinymce_mathslate||{},r=window.MathJax,i={TOOLBOX:"mathslate-toolbox",DRAGNODE:"mathslate-toolbox-drag",UNDO:"mathslate-undo-button",REDO:"mathslate-redo-button",CLEAR:"mathslate-clear-button",HELP:"mathslate-help-button"};n.Editor=function(t,s){var o=this;this.node=e.one(t),this.node.setHTML(M.util.get_string("nomathjax","tinymce_mathslate"));if(typeof r=="undefined")return;r.Hub.processSectionDelay=0;var u=e.guid(),a=e.guid(),f=e.guid();this.node.addClass(i.EDITOR),this.node.setHTML('<div id="'+u+'" class="'+i.TOOLBOX+'">'+'<div style="background-color: white; color: green; height: 300px; line-height: 75px; '+'font-size: 18px; text-align:center"><br />Mathslate Mathematics Editor<br />'+'Version 1.1 Beta</div><script type="math/tex">\\quad</script><math> <mo> </mo></math></div>'+'<div id="'+f+'" ></div>');var l=new n.MathJaxEditor("#"+f),c={tools:[],Tool:function(t){function n(e){Array.isArray(e[2])&&e[2].forEach(function(t){Array.isArray(t)?n(t):t==="[]"&&(e[2][e[2].indexOf(t)]=["mn",{},"[]"])})}function r(e){if(typeof e=="string")return e;if(typeof e[1]=="undefined")return"";var t="";return typeof e[1].tex!="undefined"?(e[1].tex.forEach(function(n){typeof n=="string"?t+=n:t+=r(e[2][n])}),t):typeof e[2]=="string"?e[2]:typeof e[2]=="undefined"?"":(e[2].forEach(function(e){t+=r(e)}),t)}this.id=e.guid(),this.json=JSON.stringify(t),this.HTMLsnippet=[["span",{id:this.id,title:r(t)},[["math",{},[t]]]]],n(t),c.tools.push(this)},fillToolBox:function(t,i){var s={children:[]},u;return r.Hub.Register.StartupHook("TeX Jax Config",function(){r.Ajax.Require("[MathJax]/extensions/toMathML.js"),s.children.push({label:'<span title="TeX"><math><mi>T</mi><mspace width="-.14em"/><mpadded height="-.5ex" depth="+.5ex" voffset="-.5ex"><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow></mpadded><mspace width="-.115em" /> <mi>X</mi> </math></span>',content:"<span id='"+a+"'></span>"})}),r.Hub.Register.StartupHook("End",function(){t.forEach(function(t){var n=e.Node.create("<p></p>");t.tools.forEach(function(e){if(e[0]&&e[0]==="br"){n.append("<br />");return}var t=new c.Tool(e);n.append("<span> "+l.toMathML(t.HTMLsnippet)+" </span>")}),s.children.push({label:t.label,content:n.getHTML()})}),u=new e.TabView(s),o.output=function(e){return l.output(e)},e.one("#"+i)&&(e.one("#"+i).setHTML(""),u.render("#"+i),e.one("#"+a)&&new n.TeXTool("#"+a,function(e){l.addMath(e)})),r.Hub.Queue(["Typeset",r.Hub,i]),r.Hub.Queue(function(){c.tools.forEach(function(t){e.one("#"+i)&&e.one("#"+i).one("#"+t.id)&&c.registerTool(t)})})}),u},getToolByID:function(e){var t;return this.tools.forEach(function(n){n.id&&n.id===e&&(t=n)}),t},registerTool:function(t){if(!e.one("#"+t.id))return;var n=new e.DD.Drag({node:"#"+t.id});n.set("data",t.json),n.on("drag:start",function(){this.get("dragNode").addClass(i.DRAGNODE)}),n.on("drag:end",function(){this.get("node").setStyle("top","0"),this.get("node").setStyle("left","0"),this.get("node").removeClass(i.DRAGNODE)})}};r.Hub.Queue(["Typeset",r.Hub,u]);var h;e.on("io:success",function(t,n){h.id===t&&r.Hub.Queue(["fillToolBox",c,e.JSON.parse(n.response),u])}),s===undefined?h=e.io(n.config):h=e.io(s),this.tbox=c,this.mje=l,l.canvas.on("drop:hit",function(e){e.drag.get("data")&&l.addMath(e.drag.get("data"))}),e.one("#"+u).delegate("click",function(){var e=c.getToolByID(this.getAttribute("id"));e&&l.addMath(e.json)},"span .yui3-dd-draggable")}},"@VERSION@",{requires:["dd-drag","dd-proxy","dd-drop","event","tabview","io-base","json","moodle-tinymce_mathslate-textool","moodle-tinymce_mathslate-mathjaxeditor"]});
